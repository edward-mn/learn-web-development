<!doctype html>
<html>
    <head>
        <title>Logica de Programação Javascript</title>
        <meta charset="utf-8">
    </head>
    <body>
      <h2> Curso - Chronometer - Javascript </h2>
      
      <input type="text" id="cronometro">
      <button id="iniciar">Iniciar</button>
      <button id="pausar">Pausar</button>
      <button id="parar">Parar</button>
      
      <script>
          
          (function(){
              
              var $inputCronometro = document.querySelector('#cronometro');
              var $iniciar = document.querySelector('#iniciar');
              var $pausar = document.querySelector('#pausar');
              var $parar = document.querySelector('#parar');
              
              $iniciar.addEventListener('click', startChronometer);
              $pausar.addEventListener('click', pauseChronometer);
              $parar.addEventListener('click', stopChronometer);

              var interval = null;
              var tsClickStart = 0;
              var tsClickPause = 0;
              var tsTimeElapsed = 0;
              var couting = false;

              function formataTS(time){
                const miliSecond = 60000, second = 1000, minute = 60;
                
                if(time < second){
                  return time;
                } else if(time < miliSecond){ // 30500
                  var seconds = partseInt(time / second); // 30
                  var hundredth = time - (seconds * second) // 30500 - (30000) = 500
                  return seconds + ":" + hundredth;
                } else { // Maior que minuto
                  var minutes = parseInt(time / miliSecond); // Minute
                  var seconds = parseInt((time / second) - (minutes * minute)); // 
                  var hundredth = time - (seconds * second) - (minutes * minute * second); //
                  return minutes + ":" + seconds + ":" + hundredth;
                }
              };

              function chronometer(timeElapsed){
                var time = timeElapsed || 0;
                interval = setInterval(() => {
                  var tsNow = Date.now();
                  var difference = tsNow - tsClickStart;
                  $inputCronometro.value = formataTS(difference + time);
                }, 100); //10x p segundo;
              };

              function startChronometer(){
                if(couting) return; // Se estiver rodando sai da função
                tsClickStart = Date.now();
                chronometer();
                couting = true;
              };

              function pauseChronometer(){
                if (!$inputCronometro.value) return;
                if(couting){
                  couting = false; // Desativando o contador de tempo
                  clearInterval(interval);
                  tsClickPause = Date.now(); // Armazena o momento da pausa
                  tsTimeElapsed += tsClickPause - tsClickStart; // Descobrindo o tempo decorrido
                  // $pausar.textContent = "Despausar";
                } else {
                  couting = true; // Ativando o contador de tempo
                  tsClickStart = Date.now(); // Resetar o valor inicial
                  chronometer(tsTimeElapsed); // Iniciando o chronometro com tempo decorrido
                }
              };

              function stopChronometer(){
                tsClickPause = 0;
                tsClickStart = 0;
                tsTimeElapsed = 0;
                couting = false;
                clearInterval(interval);
                $inputCronometro.value = '';
              };
          })();
      </script>
    </body>
</html>